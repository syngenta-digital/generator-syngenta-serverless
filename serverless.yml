app: grower
service: contracts
package:
  individually: true
  exclude:
    - README.md
    - buildspec.yml
    - serverless.yml
    - package.json
    - package-lock.json
custom:
  authorizer: '${file(./aws/envs/${opt:aws_envs, ''local''}.yml):authorizer}'
  cors: '${file(./aws/envs/${opt:aws_envs, ''local''}.yml):cors}'
  arn: '${file(./aws/envs/${opt:aws_envs, ''local''}.yml):arn}'
  serverless-offline:
    port: 9000
    stage: local
    prefix: '${self:app}-${self:service}'
    region: us-east-2
    noAuth: true
  neo4j_config:
    local:
      host: 'bolt://localhost:7687'
      user: neo4j
      password: password
      encrypted: ENCRYPTION_OFF
  security_group: '${file(aws/resources/security-group-rules.yml):groups}'
  db_instance_size:
    local: db.t2.small
    dev: db.t2.small
    qa: db.m4.large
    uat: db.m4.large
    prod: db.m4.large
provider:
  name: aws
  runtime: nodejs12.x
  logRetentionInDays: 3
  versionFunctions: false
  endpointType: regional
  environment: '${file(./aws/envs/${opt:aws/envs, ''local''}.yml):environment}'
  stage: '${opt:stage, ''local''}'
  region: '${opt:region, ''us-east-2''}'
  profile: '${opt:stage, ''local''}'
  stackName: '${self:provider.stackTags.name}'
  apiName: '${self:provider.stackTags.name}'
  deploymentBucket:
    name: '${self:provider.stage}-syngenta-deployments'
  stackTags:
    name: '${self:provider.stage}-${self:app}-${self:service}'
    service: '${self:service}'
    environment: '${self:provider.stage}'
    managedby: serverless
  iamRoleStatements:
    - '${file(./aws/iamroles/dynamodb.yml)}'
    - '${file(./aws/iamroles/s3.yml)}'
    - '${file(./aws/iamroles/ssm.yml)}'
    - '${file(./aws/iamroles/sqs.yml)}'
    - '${file(./aws/iamroles/sns.yml)}'
    - '${file(aws/iamroles/ssm.yml)}'
plugins:
  - serverless-plugin-bind-deployment-id
  - serverless-offline
functions:
  v1-apigateway-handler:
    name: '${self:provider.stackTags.name}-v1-apigateway-handler'
    description: API Router handler
    handler: application/v1/controller/apigateway/_router.route
    memorySize: 256
    timeout: 30
  v1-database-versioner:
    name: '${self:provider.stackTags.name}-v1-database-versioner'
    description: Applies versions to DB
    handler: application/v1/controller/console/_router.apply
    memorySize: 512
    timeout: 900
resources:
  - '${file(aws/resources/apigateway.yml}'
  - '${file(aws/resources/rds-mysql.yml}'
  - '${file(aws/resources/security-group.yml}'
  - '${file(aws/resources/vpc-rds.yml}'
